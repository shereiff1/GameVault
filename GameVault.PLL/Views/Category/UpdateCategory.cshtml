@model GameVault.BLL.ModelVM.Category.CategoryDTO
@{
    ViewData["Title"] = "Edit Category";
}
<h2>Edit Category</h2>
@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">
        @ViewBag.Error
    </div>
}
<form>
   
    <input type="hidden" asp-for="Category_Id" value="@Model.Category_Id" />
    <div class="mb-3">
        <label asp-for="Category_Name" class="form-label"></label>
        
        <input asp-for="Category_Name" id="Category_Name" class="form-control" value="@Model.Category_Name" required />
        <span asp-validation-for="Category_Name" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Description" class="form-label"></label>
        
        <textarea asp-for="Description" id="Description" class="form-control">@Model.Description</textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="CreatedBy" class="form-label"></label>
       
        <input asp-for="CreatedBy" id="CreatedBy" class="form-control" value="@Model.CreatedBy" required />
        <span asp-validation-for="CreatedBy" class="text-danger"></span>
    </div>
    <button type="submit" id="formSubmit" class="btn btn-success">Update</button>
    <a asp-action="GetAllCategories" class="btn btn-secondary">Back to List</a>
</form>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    document.getElementById('formSubmit').addEventListener('click', async function (e) {
        e.preventDefault()
        try {
            const response = await fetch('/Category/Update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                
                    Category_Id: parseInt(document.querySelector('input[name="Category_Id"]').value),
                    Category_Name: document.getElementById('Category_Name').value,
                    Description: document.getElementById('Description').value,
                    CreatedBy: document.getElementById('CreatedBy').value,
                }),
            });
            const updatedCategory = await response.json();
            if (!response.ok) {
                console.error("Server responded with error:", updatedCategory);
                throw new Error(updatedCategory.errorMessage || "Failed to update category");
            }
            console.log("Updated Category:", updatedCategory);
            if (updatedCategory.redirectUrl) {
                window.location.href = updatedCategory.redirectUrl;
            } else {
                window.location.href = '/Category/GetAllCategories';
            }
        } catch (error) {
            console.error("Update Error:", error);
            alert("Error updating category: " + error.message);
        }
    });
</script>