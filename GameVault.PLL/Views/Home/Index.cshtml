@using GameVault.BLL.ModelVM.Game
@model List<GameDetails>
@{
    ViewData["Title"] = "Home Page - GameVault";
    var featuredGame = ViewBag.FeaturedGame as GameDetails;
}

<div class="container-fluid">
    <div class="row mb-5">
        <div class="col-12">
            <div class="jumbotron bg-primary text-white text-center py-5 rounded">
                <h1 class="display-4 fw-bold">Welcome to GameVault</h1>
                <p class="lead">Discover amazing games from top developers around the world</p>
                <hr class="my-4 bg-white">
                <p class="mb-4">Your ultimate destination for the latest and greatest games</p>
            </div>
        </div>
    </div>
    @if (featuredGame != null)
    {
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="text-center mb-4">
                    <i class="fas fa-star text-warning"></i>
                    Game of the Moment
                    <i class="fas fa-star text-warning"></i>
                </h2>
                <p class="text-center text-muted mb-4">
                    <i class="fas fa-clock"></i> Updates every 10 seconds
                </p>
                <div class="featured-game-card mx-auto">
                    <div class="card border-0 shadow-lg" style="max-width: 800px;">
                        <div class="row g-0">
                            <div class="col-md-5">
                                <div class="position-relative h-100">
                                    @if (!string.IsNullOrEmpty(featuredGame.ImagePath))
                                    {
                                        <img src="~/Files/@featuredGame.ImagePath" class="img-fluid h-100 w-100 rounded-start" alt="@featuredGame.Title" style="object-fit: cover; min-height: 300px;">
                                    }
                                    else
                                    {
                                        <div class="bg-light d-flex align-items-center justify-content-center h-100 rounded-start" style="min-height: 300px;">
                                            <i class="fas fa-gamepad text-muted" style="font-size: 4rem;"></i>
                                        </div>
                                    }

                                    @if (featuredGame.Price > 0)
                                    {
                                        <span class="badge bg-success position-absolute top-0 end-0 m-3 fs-5">
                                            $@featuredGame.Price.ToString("F2")
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-info position-absolute top-0 end-0 m-3 fs-5">
                                            Free
                                        </span>
                                    }
                                </div>
                            </div>
                            <div class="col-md-7">
                                <div class="card-body p-4 d-flex flex-column h-100">
                                    <div>
                                        <h3 class="card-title fw-bold text-primary mb-2">@featuredGame.Title</h3>

                                        <p class="text-muted mb-3">
                                            <i class="fas fa-building"></i> @featuredGame.CompanyName
                                        </p>

                                        @if (featuredGame.Categories != null && featuredGame.Categories.Any())
                                        {
                                            <div class="mb-3">
                                                @foreach (var category in featuredGame.Categories.Take(4))
                                                {
                                                    <span class="badge bg-secondary me-1 mb-1">@category.Category_Name</span>
                                                }
                                                @if (featuredGame.Categories.Count > 4)
                                                {
                                                    <span class="badge bg-light text-dark">+@(featuredGame.Categories.Count - 4) more</span>
                                                }
                                            </div>
                                        }

                                        <p class="card-text mb-3" style="max-height: 100px; overflow-y: auto;">
                                            @(string.IsNullOrEmpty(featuredGame.Description) ? "No description available." : featuredGame.Description)
                                        </p>

                                        @if (featuredGame.Rating > 0)
                                        {
                                            <div class="d-flex align-items-center mb-3">
                                                <span class="text-warning me-2">
                                                    @for (int i = 1; i <= 5; i++)
                                                    {
                                                        if (i <= Math.Floor(featuredGame.Rating))
                                                        {
                                                            <i class="fas fa-star"></i>
                                                        }
                                                        else if (i <= featuredGame.Rating)
                                                        {
                                                            <i class="fas fa-star-half-alt"></i>
                                                        }
                                                        else
                                                        {
                                                            <i class="far fa-star"></i>
                                                        }
                                                    }
                                                </span>
                                                <span class="fw-bold me-3">@featuredGame.Rating.ToString("F1")</span>
                                                @if (featuredGame.Reviews != null && featuredGame.Reviews.Any())
                                                {
                                                    <small class="text-muted">
                                                        (@featuredGame.Reviews.Count review@(featuredGame.Reviews.Count != 1 ? "s" : ""))
                                                    </small>
                                                }
                                            </div>
                                        }
                                    </div>

                                    <div class="mt-auto">
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <a asp-controller="Game" asp-action="GameDetails" asp-route-id="@featuredGame.GameId"
                                                   class="btn btn-primary w-100">
                                                    <i class="fas fa-eye"></i> View Details
                                                </a>
                                            </div>
                                            <div class="col-md-6">
                                                <button class="btn btn-success w-100" data-game-id="@featuredGame.GameId">
                                                    <i class="fas fa-cart-plus"></i> Add to Cart
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="text-center mb-4">All Games</h2>
                <p class="text-center text-muted mb-5">Browse our collection of @Model.Count amazing games</p>
            </div>
        </div>

        <div class="row g-4">
            @foreach (var game in Model)
            {
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12">
                    <div class="card h-100 shadow-sm game-card">
                        <div class="position-relative">
                            @if (!string.IsNullOrEmpty(game.ImagePath))
                            {
                                <img src="~/Files/@game.ImagePath" class="card-img-top" alt="@game.Title" style="height: 200px; object-fit: cover;">
                            }
                            else
                            {
                                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                                    <i class="fas fa-gamepad text-muted" style="font-size: 3rem;"></i>
                                </div>
                            }

                            @if (game.Price > 0)
                            {
                                <span class="badge bg-success position-absolute top-0 end-0 m-2 fs-6">
                                    $@game.Price.ToString("F2")
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-info position-absolute top-0 end-0 m-2">
                                    Free
                                </span>
                            }
                        </div>

                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title text-truncate" title="@game.Title">@game.Title</h5>

                            <p class="card-text text-muted small mb-2">
                                <i class="fas fa-building"></i> @game.CompanyName
                            </p>

                            <p class="card-text flex-grow-1 text-truncate-3" title="@game.Description">
                                @(string.IsNullOrEmpty(game.Description) ? "No description available." : game.Description)
                            </p>

                            @if (game.Categories != null && game.Categories.Any())
                            {
                                <div class="mb-3">
                                    @foreach (var category in game.Categories.Take(3))
                                    {
                                        <span class="badge bg-secondary me-1 mb-1">@category.Category_Name</span>
                                    }
                                    @if (game.Categories.Count > 3)
                                    {
                                        <span class="badge bg-light text-dark">+@(game.Categories.Count - 3) more</span>
                                    }
                                </div>
                            }

                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div>
                                    @if (game.Rating > 0)
                                    {
                                        <div class="d-flex align-items-center">
                                            <span class="text-warning me-1">
                                                @for (int i = 1; i <= 5; i++)
                                                {
                                                    if (i <= Math.Floor(game.Rating))
                                                    {
                                                        <i class="fas fa-star"></i>
                                                    }
                                                    else if (i <= game.Rating)
                                                    {
                                                        <i class="fas fa-star-half-alt"></i>
                                                    }
                                                    else
                                                    {
                                                        <i class="far fa-star"></i>
                                                    }
                                                }
                                            </span>
                                            <small class="text-muted">@game.Rating.ToString("F1")</small>
                                        </div>
                                    }
                                    else
                                    {
                                        <small class="text-muted">No ratings yet</small>
                                    }
                                </div>

                                @if (game.Reviews != null && game.Reviews.Any())
                                {
                                    <small class="text-muted">
                                        <i class="fas fa-comment"></i> @game.Reviews.Count review@(game.Reviews.Count != 1 ? "s" : "")
                                    </small>
                                }
                            </div>

                            @if (game.Reviews != null && game.Reviews.Any())
                            {
                                var firstReview = game.Reviews.FirstOrDefault();
                                @if (firstReview != null && !string.IsNullOrEmpty(firstReview.Comment))
                                {
                                    <div class="mb-3">
                                        <small class="text-muted fst-italic">
                                            <i class="fas fa-quote-left"></i>
                                            "@(firstReview.Comment.Length > 60 ? firstReview.Comment.Substring(0, 60) + "..." : firstReview.Comment)"
                                            <i class="fas fa-quote-right"></i>
                                        </small>
                                    </div>
                                }
                            }

                            <div class="mt-auto">
                                <div class="d-grid gap-2">
                                    <a asp-controller="Game" asp-action="GameDetails" asp-route-id="@game.GameId" class="btn btn-primary">
                                        <i class="fas fa-eye"></i> View Details
                                    </a>
                                    <button class="btn btn-outline-success btn-sm" data-game-id="@game.GameId">
                                        <i class="fas fa-cart-plus"></i> Add to Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="row mt-5">
            <div class="col-12 text-center">
                <a href="@Url.Action("Index", "Game")" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-gamepad"></i> View All Games
                </a>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-12 text-center">
                <div class="alert alert-info py-5" role="alert">
                    <i class="fas fa-gamepad fa-3x mb-3 text-muted"></i>
                    <h4 class="alert-heading">No Games Available</h4>
                    <p class="mb-0">There are currently no games to display. Check back later for new releases!</p>
                    <hr>
                    <p class="mb-0">
                        <a href="@Url.Action("Add", "Game")" class="btn btn-primary">Add New Game</a>
                        <a href="@Url.Action("Add", "Company")" class="btn btn-outline-primary ms-2">Add Company</a>
                    </p>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .game-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
        border-radius: 15px;
        overflow: hidden;
    }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
        }

    .featured-game-card .card {
        background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
        border-radius: 20px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 3px solid #667eea;
    }

        .featured-game-card .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15) !important;
        }

    .jumbotron {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px;
    }

    .text-truncate-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.4;
        height: calc(1.4em * 3);
    }

    .badge {
        font-size: 0.75em;
    }

    .card-img-top {
        transition: transform 0.3s ease;
    }

    .game-card:hover .card-img-top {
        transform: scale(1.05);
    }

    .fas, .far {
        font-family: "Font Awesome 5 Free";
    }

    /* Ensure consistent card heights */
    .card {
        min-height: 500px;
    }
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle Add to Cart buttons
        document.querySelectorAll('[data-game-id]').forEach(button => {
            if (button.textContent.includes('Add to Cart')) {
                button.addEventListener('click', function() {
                    const gameId = this.getAttribute('data-game-id');

                    // Visual feedback
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
                    this.disabled = true;

                    // Simulate cart addition (replace with actual cart logic)
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-check"></i> Added!';
                        this.classList.remove('btn-outline-success');
                        this.classList.add('btn-success');

                        // Reset after 2 seconds
                        setTimeout(() => {
                            this.innerHTML = originalText;
                            this.disabled = false;
                            this.classList.remove('btn-success');
                            this.classList.add('btn-outline-success');
                        }, 2000);
                    }, 1000);

                    console.log('Add to cart game:', gameId);
                    // Add your actual cart logic here
                });
            }
        });

        // Add loading animation for View Details buttons
        document.querySelectorAll('a[asp-action="GameDetails"]').forEach(link => {
            link.addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            });
        });

        // Auto-refresh the page every 10 seconds to show the new featured game
        setInterval(function() {
            window.location.reload();
        }, 10000); // 10000 ms = 10 seconds
    });
</script>